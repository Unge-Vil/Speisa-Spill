<!DOCTYPE html>
<html lang="no">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Speisa Spill - Unge Vil</title>
    <!-- Tailwind CSS for styling -->
    <script src="https://cdn.tailwindcss.com"></script>
    <!-- Google Fonts: Orbitron for Sci-Fi look, Poppins for tekst -->
    <link href="https://fonts.googleapis.com/css2?family=Orbitron:wght@400;700;900&family=Poppins:wght@300;400;600&display=swap" rel="stylesheet">
    <!-- FontAwesome for ikoner -->
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css">
    
    <script>
        tailwind.config = {
            theme: {
                extend: {
                    fontFamily: {
                        sans: ['Poppins', 'sans-serif'],
                        scifi: ['Orbitron', 'sans-serif'],
                    },
                    colors: {
                        'space-dark': '#050510',
                        'space-panel': 'rgba(20, 20, 40, 0.7)',
                        'neon-pink': '#ff00ff',
                        'neon-blue': '#00ffff',
                        'neon-purple': '#bd00ff'
                    },
                    animation: {
                        'pulse-glow': 'pulse-glow 3s infinite',
                        'cursor-blink': 'blink 1s step-end infinite',
                    },
                    keyframes: {
                        'pulse-glow': {
                            '0%, 100%': { boxShadow: '0 0 10px #bd00ff' },
                            '50%': { boxShadow: '0 0 25px #00ffff' },
                        },
                        'blink': {
                            '0%, 100%': { opacity: '1' },
                            '50%': { opacity: '0' },
                        }
                    }
                }
            }
        }
    </script>
    <style>
        body {
            background-color: #050510;
            color: #ffffff;
            overflow-x: hidden;
            perspective: 1000px; /* Nødvendig for 3D-effekter */
        }

        /* Dynamisk stjernebakgrunn */
        #star-bg {
            position: fixed;
            top: 0;
            left: 0;
            width: 110%;
            height: 110%;
            background-image: 
                radial-gradient(white, rgba(255,255,255,.2) 2px, transparent 3px),
                radial-gradient(white, rgba(255,255,255,.15) 1px, transparent 2px),
                radial-gradient(white, rgba(255,255,255,.1) 2px, transparent 3px);
            background-size: 550px 550px, 350px 350px, 250px 250px;
            z-index: -1;
            transition: transform 0.1s ease-out;
        }

        .glass-panel {
            background: rgba(22, 33, 62, 0.6);
            backdrop-filter: blur(10px);
            -webkit-backdrop-filter: blur(10px);
            border: 1px solid rgba(0, 255, 255, 0.1);
        }

        /* 3D TILT EFFEKT */
        .game-card {
            transition: transform 0.1s ease-out, box-shadow 0.3s ease;
            transform-style: preserve-3d;
            perspective: 1000px;
        }
        
        .game-card-inner {
            transform: translateZ(0); /* Hardware acceleration */
        }

        .neon-text {
            text-shadow: 0 0 10px rgba(189, 0, 255, 0.7);
        }

        /* Scrollbar styling */
        ::-webkit-scrollbar {
            width: 10px;
        }
        ::-webkit-scrollbar-track {
            background: #050510; 
        }
        ::-webkit-scrollbar-thumb {
            background: #00ffff; 
            border-radius: 5px;
        }
        ::-webkit-scrollbar-thumb:hover {
            background: #ff00ff; 
        }
    </style>
</head>
<body class="min-h-screen flex flex-col" id="main-body">

    <!-- Parallax Background Layer -->
    <div id="star-bg"></div>

    <!-- Header / Navigasjon -->
    <header class="glass-panel sticky top-0 z-50 border-b border-gray-800">
        <div class="container mx-auto px-6 py-4 flex justify-between items-center">
            <div class="flex items-center gap-6">
                <!-- LOGO -->
                <a href="https://ungevil.no" target="_blank" class="block group">
                    <img src="https://www.ungevil.no/wp-content/uploads/2024/01/UngeVil-dark-line.png" 
                         alt="Unge Vil Logo" 
                         class="h-10 md:h-12 w-auto filter drop-shadow-[0_0_8px_rgba(255,255,255,0.4)] group-hover:drop-shadow-[0_0_15px_rgba(0,255,255,0.6)] transition-all duration-300">
                </a>
                
                <div class="hidden sm:block border-l border-gray-600 pl-6 h-8 flex items-center">
                    <h1 class="text-xl md:text-2xl font-black tracking-widest font-scifi uppercase bg-clip-text text-transparent bg-gradient-to-r from-neon-pink to-neon-blue">
                        SPEISA SPILL
                    </h1>
                </div>
            </div>
            <a href="https://github.com" target="_blank" class="text-gray-400 hover:text-neon-blue transition duration-300 transform hover:rotate-12">
                <i class="fa-brands fa-github text-3xl"></i>
            </a>
        </div>
        <!-- Mobil tittel -->
        <div class="sm:hidden text-center pb-2">
            <h1 class="text-xl font-black tracking-widest font-scifi uppercase bg-clip-text text-transparent bg-gradient-to-r from-neon-pink to-neon-blue">
                SPEISA SPILL
            </h1>
        </div>
    </header>

    <!-- Hero Seksjon -->
    <div class="container mx-auto px-6 py-16 text-center relative z-10">
        <!-- Dekorativ planet effekt -->
        <div class="absolute top-1/2 left-1/2 -translate-x-1/2 -translate-y-1/2 w-64 h-64 bg-neon-purple rounded-full blur-[100px] opacity-20 -z-10 animate-pulse"></div>

        <h2 class="text-3xl md:text-5xl font-bold mb-6 font-scifi text-white neon-text">
            Velkommen til <span class="text-neon-blue">Portalrommet</span>
        </h2>
        
        <!-- Typewriter Text Container -->
        <div class="h-16 md:h-12 flex items-center justify-center mb-8">
            <p id="typewriter" class="text-blue-200 text-lg md:text-xl font-mono tracking-wide">
                <!-- Tekst skrives her av JS -->
            </p>
            <span class="animate-cursor-blink w-2 h-6 bg-neon-pink ml-1 inline-block"></span>
        </div>
        
        <!-- Søkefelt -->
        <div class="relative max-w-md mx-auto group transform hover:scale-105 transition-transform duration-300">
            <div class="absolute -inset-1 bg-gradient-to-r from-neon-pink to-neon-blue rounded-lg blur opacity-25 group-hover:opacity-75 transition duration-1000 group-hover:duration-200"></div>
            <div class="relative">
                <input type="text" id="searchInput" placeholder="Søk i universet..." 
                    class="w-full bg-space-dark bg-opacity-90 border border-gray-700 rounded-lg py-4 px-6 pl-12 focus:outline-none text-white font-mono placeholder-gray-500 shadow-2xl">
                <i class="fa-solid fa-rocket absolute left-4 top-4 text-neon-blue group-hover:animate-bounce"></i>
            </div>
        </div>
    </div>

    <!-- Spill Grid -->
    <main class="container mx-auto px-6 pb-24 flex-grow z-10">
        <div id="gameGrid" class="grid grid-cols-1 sm:grid-cols-2 lg:grid-cols-3 gap-8 perspective-container">
            <!-- Spinner -->
            <div class="col-span-full text-center py-20">
                <i class="fa-solid fa-spinner fa-spin text-4xl text-neon-blue"></i>
                <p class="mt-4 text-gray-400">Kobler til spill-databasen...</p>
            </div>
        </div>

        <!-- Tomt søkeresultat melding -->
        <div id="noResults" class="hidden text-center py-10">
            <i class="fa-solid fa-meteor text-6xl text-gray-600 mb-4 animate-spin-slow"></i>
            <p class="text-xl text-gray-400 font-scifi">Ingen livstegn funnet...</p>
        </div>

        <!-- Feilmelding (hvis JSON mangler eller er ødelagt) -->
        <div id="errorMsg" class="hidden text-center py-10">
            <i class="fa-solid fa-triangle-exclamation text-6xl text-red-500 mb-4"></i>
            <p class="text-xl text-gray-400">SYSTEM FEIL: Kunne ikke lese spilldata.</p>
            <p class="text-sm text-gray-600 mt-2">Sjekk at spill.json finnes og er gyldig.</p>
        </div>
    </main>

    <!-- Footer -->
    <footer class="glass-panel py-8 text-center text-gray-400 text-sm border-t border-gray-800 mt-auto z-10">
        <p class="font-mono">SYSTEM STATUS: ONLINE | &copy; <span id="year"></span> Unge Vil</p>
    </footer>

    <!-- LOGIKK OG DATA -->
    <script>
        // ==========================================
        // KONFIGURASJON OG VARIABLER
        // ==========================================
        
        let spillListe = []; 
        const gameGrid = document.getElementById('gameGrid');
        const searchInput = document.getElementById('searchInput');
        const noResults = document.getElementById('noResults');
        const errorMsg = document.getElementById('errorMsg');

        // Dynamisk årstall i footer
        document.getElementById('year').textContent = new Date().getFullYear();

        // ==========================================
        // 1. VISUELLE EFFEKTER
        // ==========================================

        // 3D Tilt Effekt for spillkort
        function addTiltEffect(card) {
            card.addEventListener('mousemove', (e) => {
                const rect = card.getBoundingClientRect();
                const x = e.clientX - rect.left;
                const y = e.clientY - rect.top;
                
                // Regn ut rotasjon basert på musens posisjon i kortet
                const xPct = x / rect.width;
                const yPct = y / rect.height;
                
                const xRotation = (yPct - 0.5) * 20 * -1; // Opp/Ned tilt
                const yRotation = (xPct - 0.5) * 20;      // Venstre/Høyre tilt
                
                card.style.transform = `perspective(1000px) rotateX(${xRotation}deg) rotateY(${yRotation}deg) scale(1.05)`;
            });

            card.addEventListener('mouseleave', () => {
                // Reset posisjon når musen forlater
                card.style.transform = 'perspective(1000px) rotateX(0) rotateY(0) scale(1)';
            });
        }

        // Typewriter effekt for velkomsttekst
        const textToType = "Utforsk vårt univers av AI-genererte spill.";
        const typeContainer = document.getElementById('typewriter');
        let typeIndex = 0;

        function typeWriter() {
            if (typeIndex < textToType.length) {
                typeContainer.innerHTML += textToType.charAt(typeIndex);
                typeIndex++;
                setTimeout(typeWriter, 50); // Hastighet på skrivingen
            }
        }

        // Parallax Bakgrunn (Stjerner flytter seg med musen)
        document.addEventListener('mousemove', (e) => {
            const bg = document.getElementById('star-bg');
            const x = (window.innerWidth - e.pageX * 2) / 100;
            const y = (window.innerHeight - e.pageY * 2) / 100;
            bg.style.transform = `translateX(${x}px) translateY(${y}px)`;
        });

        // ==========================================
        // 2. LASTE DATA (JSON)
        // ==========================================

        async function initSystem() {
            try {
                // Henter spill.json. ?v=... brukes for å unngå at nettleseren husker gamle versjoner.
                const response = await fetch('spill.json?v=' + Date.now());
                
                if (!response.ok) throw new Error('Fant ikke filen');
                
                spillListe = await response.json();
                renderGames(spillListe);
                
            } catch (error) {
                console.error("Kritisk feil: Kunne ikke laste spill.json", error);
                // Skjul loading spinner (ved å tømme grid)
                gameGrid.innerHTML = ''; 
                // Vis feilmelding til brukeren
                errorMsg.classList.remove('hidden');
            }
        }

        // ==========================================
        // 3. RENDERING OG SØK
        // ==========================================

        function renderGames(games) {
            gameGrid.innerHTML = '';
            
            if (games.length === 0) {
                noResults.classList.remove('hidden');
            } else {
                noResults.classList.add('hidden');
                
                games.forEach(spill => {
                    const card = document.createElement('div');
                    // Merk: transition-transform er fjernet her for å unngå konflikt med JS-tilt
                    card.className = `game-card glass-panel rounded-lg overflow-hidden flex flex-col h-full border border-gray-800 hover:border-neon-blue shadow-lg`;
                    
                    card.innerHTML = `
                        <div class="game-card-inner h-full flex flex-col">
                            <div class="h-44 ${spill.farge} flex items-center justify-center relative overflow-hidden border-b border-gray-700">
                                <i class="${spill.ikon} text-7xl text-white opacity-90 filter drop-shadow-[0_0_10px_rgba(255,255,255,0.5)] z-10"></i>
                                
                                <!-- Scanningslinje effekt -->
                                <div class="absolute inset-0 bg-gradient-to-b from-transparent via-white/10 to-transparent w-full h-full animate-[float_3s_ease-in-out_infinite] opacity-30"></div>
                                
                                <!-- Grid effekt -->
                                <div class="absolute inset-0 opacity-20" 
                                    style="background-image: linear-gradient(#00ffff 1px, transparent 1px), linear-gradient(90deg, #00ffff 1px, transparent 1px); background-size: 30px 30px;">
                                </div>
                            </div>
                            
                            <div class="p-6 flex flex-col flex-grow bg-opacity-40 bg-black">
                                <h3 class="text-xl font-bold mb-2 text-white font-scifi tracking-wide group-hover:text-neon-pink transition-colors">${spill.tittel}</h3>
                                <p class="text-blue-100/70 text-sm mb-6 flex-grow font-mono leading-relaxed">${spill.beskrivelse}</p>
                                
                                <a href="${spill.url}" class="relative block text-center w-full py-3 border border-neon-blue text-neon-blue font-bold rounded overflow-hidden hover:bg-neon-blue hover:text-black transition-all duration-300 shadow-[0_0_10px_rgba(0,255,255,0.2)] hover:shadow-[0_0_20px_rgba(0,255,255,0.6)]">
                                    <span class="relative z-10 flex items-center justify-center gap-2">
                                        START PROTOKOLL <i class="fa-solid fa-play text-xs"></i>
                                    </span>
                                </a>
                            </div>
                        </div>
                    `;
                    gameGrid.appendChild(card);
                    
                    // Aktiver 3D-tilt på kortet
                    addTiltEffect(card);
                });
            }
        }

        // Søkefunksjonalitet
        searchInput.addEventListener('input', (e) => {
            const searchTerm = e.target.value.toLowerCase();
            const filteredGames = spillListe.filter(spill => 
                spill.tittel.toLowerCase().includes(searchTerm) || 
                spill.beskrivelse.toLowerCase().includes(searchTerm)
            );
            renderGames(filteredGames);
        });

        // Start systemet
        initSystem();
        setTimeout(typeWriter, 500); 

    </script>
</body>
</html>
