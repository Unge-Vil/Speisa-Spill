<!DOCTYPE html>
<html lang="no">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Emoji Quiz Party! üéâ</title>
    <script src="https://cdn.tailwindcss.com"></script>
    <script src="https://cdn.jsdelivr.net/npm/canvas-confetti@1.6.0/dist/confetti.browser.min.js"></script>
    <style>
        @import url('https://fonts.googleapis.com/css2?family=Fredoka:wght@400;600;700&display=swap');

        body {
            font-family: 'Fredoka', sans-serif;
            overflow: hidden; /* Prevent scrolling during animations */
        }

        /* Animated Background */
        .animated-bg {
            background: linear-gradient(-45deg, #ee7752, #e73c7e, #23a6d5, #23d5ab);
            background-size: 400% 400%;
            animation: gradientBG 15s ease infinite;
        }

        @keyframes gradientBG {
            0% { background-position: 0% 50%; }
            50% { background-position: 100% 50%; }
            100% { background-position: 0% 50%; }
        }

        /* Card Glassmorphism */
        .glass-panel {
            background: rgba(255, 255, 255, 0.9);
            backdrop-filter: blur(10px);
            border: 4px solid rgba(255, 255, 255, 0.5);
            box-shadow: 0 8px 32px 0 rgba(31, 38, 135, 0.37);
            animation: floatCard 6s ease-in-out infinite;
        }

        @keyframes floatCard {
            0%, 100% { transform: translateY(0); }
            50% { transform: translateY(-10px); }
        }

        /* Emoji Animation */
        .emoji-bounce {
            animation: bounce 2s infinite;
        }

        @keyframes bounce {
            0%, 100% { transform: translateY(-5%); }
            50% { transform: translateY(5%); }
        }

        /* Button Interactions */
        .option-btn {
            transition: all 0.2s cubic-bezier(0.25, 0.8, 0.25, 1);
            transform-style: preserve-3d;
            /* Start hidden for entrance animation */
            opacity: 0;
            transform: translateY(20px);
            animation: slideIn 0.4s forwards;
        }

        @keyframes slideIn {
            to { opacity: 1; transform: translateY(0); }
        }

        .option-btn:active {
            transform: scale(0.95) translateY(4px);
        }

        .option-btn:hover {
            transform: translateY(-2px);
            box-shadow: 0 10px 20px rgba(0,0,0,0.2);
        }

        /* Time Selection Buttons */
        .time-btn {
            transition: all 0.3s ease;
            border: 2px solid transparent;
        }
        .time-btn.selected {
            background-color: #4f46e5; /* indigo-600 */
            color: white;
            border-color: #818cf8;
            transform: scale(1.05);
            box-shadow: 0 0 15px rgba(79, 70, 229, 0.5);
        }

        /* Wrong Answer Shake */
        .shake {
            animation: shake 0.5s cubic-bezier(.36,.07,.19,.97) both;
        }

        @keyframes shake {
            10%, 90% { transform: translate3d(-2px, 0, 0); }
            20%, 80% { transform: translate3d(4px, 0, 0); }
            30%, 50%, 70% { transform: translate3d(-8px, 0, 0); }
            40%, 60% { transform: translate3d(8px, 0, 0); }
        }

        /* Right Answer Pop - FIXED VISIBILITY */
        .pop-success {
            animation: popSuccess 0.5s cubic-bezier(0.175, 0.885, 0.32, 1.275) !important;
            background: linear-gradient(135deg, #4ade80 0%, #22c55e 100%) !important;
            color: white !important;
            border-color: #166534 !important;
            z-index: 10;
            opacity: 1 !important; /* Force visible */
            transform: translateY(0) !important; /* Reset position */
        }

        @keyframes popSuccess {
            0% { transform: scale(1); }
            50% { transform: scale(1.1); }
            100% { transform: scale(1); }
        }

        /* Wrong Answer Pop - FIXED VISIBILITY */
        .pop-fail {
            background: linear-gradient(135deg, #f87171 0%, #ef4444 100%) !important;
            color: white !important;
            border-color: #991b1b !important;
            opacity: 1 !important; /* Force visible */
            transform: translateY(0) !important; /* Reset position */
        }

        /* Floating particles */
        .floater {
            position: absolute;
            opacity: 0.3;
            animation: floatUp 10s linear infinite;
            z-index: 0;
            pointer-events: none;
        }

        @keyframes floatUp {
            0% { transform: translateY(110vh) rotate(0deg); }
            100% { transform: translateY(-10vh) rotate(360deg); }
        }

        .progress-bar-fill {
            transition: width 0.5s ease-out;
        }

        /* Timer Animation */
        @keyframes timerShrink {
            from { width: 100%; }
            to { width: 0%; }
        }
        
        .timer-active {
            animation-timing-function: linear;
            animation-fill-mode: forwards;
        }

        .timer-danger {
            animation: pulseRed 0.5s infinite;
        }

        @keyframes pulseRed {
            0%, 100% { background-color: #ef4444; box-shadow: 0 0 5px #ef4444; }
            50% { background-color: #ff0000; box-shadow: 0 0 15px #ff0000; }
        }

    </style>
</head>
<body class="animated-bg h-screen w-screen flex items-center justify-center relative">

    <!-- Floating Emojis Background -->
    <div id="background-elements"></div>

    <!-- Main Game Container -->
    <main class="w-full max-w-md p-4 relative z-10">
        
        <!-- START SCREEN -->
        <div id="start-screen" class="glass-panel rounded-3xl p-8 text-center animate-fade-in-up">
            <h1 class="text-5xl font-bold text-transparent bg-clip-text bg-gradient-to-r from-purple-600 to-pink-600 mb-2 filter drop-shadow-sm">
                Emoji Quiz
            </h1>
            <p class="text-gray-600 font-semibold mb-6 text-lg">Gjett filmen, tingen eller maten!</p>
            
            <div class="text-8xl mb-6 emoji-bounce cursor-pointer hover:scale-110 transition-transform">
                ü§î
            </div>

            <!-- Time Selection -->
            <div class="mb-8">
                <p class="text-sm font-bold text-gray-500 uppercase tracking-widest mb-3">Velg Tidsfrist</p>
                <div class="flex justify-center gap-3">
                    <button onclick="selectTime(5)" id="btn-5s" class="time-btn bg-white/50 hover:bg-white text-gray-700 font-bold py-2 px-4 rounded-xl shadow-sm">
                        ‚ö° 5s
                    </button>
                    <button onclick="selectTime(10)" id="btn-10s" class="time-btn bg-white/50 hover:bg-white text-gray-700 font-bold py-2 px-4 rounded-xl shadow-sm selected">
                        üï∞Ô∏è 10s
                    </button>
                    <button onclick="selectTime('inf')" id="btn-inf" class="time-btn bg-white/50 hover:bg-white text-gray-700 font-bold py-2 px-4 rounded-xl shadow-sm">
                        üßò ‚àû
                    </button>
                </div>
            </div>

            <button onclick="startGame()" class="w-full bg-gradient-to-r from-violet-600 to-indigo-600 text-white font-bold py-4 px-6 rounded-2xl shadow-lg hover:shadow-xl transform transition-all hover:-translate-y-1 text-xl border-b-4 border-indigo-800 active:border-b-0 active:translate-y-1">
                START SPILLET üöÄ
            </button>
        </div>

        <!-- GAME SCREEN -->
        <div id="game-screen" class="hidden">
            <!-- Header Info -->
            <div class="flex justify-between items-center mb-4 bg-white/80 backdrop-blur-sm rounded-xl p-3 shadow-md">
                <div class="flex flex-col">
                    <span class="text-xs font-bold text-gray-500 uppercase tracking-wider">Niv√•</span>
                    <span id="level-display" class="text-xl font-black text-indigo-600">1/10</span>
                </div>
                <div class="flex flex-col items-center">
                    <span class="text-xs font-bold text-gray-500 uppercase tracking-wider">Tid</span>
                    <span id="timer-text" class="text-xl font-black text-orange-500">10s</span>
                </div>
                <div class="flex flex-col items-end">
                    <span class="text-xs font-bold text-gray-500 uppercase tracking-wider">Poeng</span>
                    <span id="score-display" class="text-xl font-black text-pink-600">0</span>
                </div>
            </div>

            <!-- Progress Bar -->
            <div class="w-full bg-gray-300 rounded-full h-3 mb-6 overflow-hidden border-2 border-white/50">
                <div id="progress-bar" class="progress-bar-fill bg-gradient-to-r from-yellow-400 to-orange-500 h-3 rounded-full" style="width: 0%"></div>
            </div>

            <!-- Question Card -->
            <div class="glass-panel rounded-3xl p-6 mb-6 text-center shadow-2xl relative overflow-hidden transform transition-all hover:scale-[1.02]">
                <!-- Timer Bar -->
                <div class="absolute top-0 left-0 w-full h-2 bg-gray-200">
                    <div id="timer-bar" class="h-full bg-red-500 w-full"></div>
                </div>
                
                <div id="emoji-container" class="text-7xl mb-4 py-4 filter drop-shadow-lg transform transition-all duration-300 hover:scale-110 cursor-help" title="Hva er dette?">
                    ü¶Åüëë
                </div>
                <!-- Dynamic Category Text -->
                <p id="category-text" class="text-gray-500 font-bold text-sm uppercase tracking-widest mb-1">Hvilken film?</p>
            </div>

            <!-- Options Grid -->
            <div id="options-grid" class="grid grid-cols-1 gap-3">
                <!-- Buttons injected by JS -->
            </div>
            
            <div id="feedback-msg" class="h-8 text-center font-bold text-xl mt-4 text-white drop-shadow-md opacity-0 transition-opacity"></div>
        </div>

        <!-- GAME OVER SCREEN -->
        <div id="end-screen" class="hidden glass-panel rounded-3xl p-8 text-center">
            <h2 id="end-title" class="text-4xl font-black text-indigo-800 mb-4">Bra jobba! üéâ</h2>
            
            <div class="bg-white/50 rounded-xl p-4 mb-6 border-2 border-white">
                <p class="text-gray-600 text-sm uppercase font-bold">Din Score</p>
                <p id="final-score" class="text-6xl font-black text-transparent bg-clip-text bg-gradient-to-r from-pink-500 to-violet-500">
                    1000
                </p>
            </div>

            <p id="feedback-text" class="text-gray-700 font-semibold mb-8 text-lg">
                Du er en Emoji-ekspert!
            </p>

            <button onclick="startGame()" class="w-full bg-gradient-to-r from-green-500 to-emerald-600 text-white font-bold py-4 px-6 rounded-2xl shadow-lg hover:shadow-xl transform transition-all hover:-translate-y-1 text-xl border-b-4 border-emerald-800 active:border-b-0 active:translate-y-1">
                SPILL IGJEN üîÑ
            </button>
        </div>

    </main>

    <script>
        // --- GAME DATA WITH CATEGORIES ---
        const levels = [
            // FILMER & SERIER
            { category: "Hvilken film?", emojis: "ü¶Åüëë", answer: "L√∏venes Konge", options: ["L√∏venes Konge", "Tigergutt", "Jungelboken", "Madagaskar"] },
            { category: "Hvilken film?", emojis: "‚ö°üßô‚Äç‚ôÇÔ∏è", answer: "Harry Potter", options: ["Ringenes Herre", "Harry Potter", "Percy Jackson", "Trollmannen fra Oz"] },
            { category: "Hvilken film?", emojis: "üö¢üßä", answer: "Titanic", options: ["B√•ten", "Avatar", "Titanic", "Istid"] },
            { category: "Hvilken film?", emojis: "üï∑Ô∏èüï∏Ô∏è", answer: "Spider-Man", options: ["Batman", "Spider-Man", "Venom", "Ant-Man"] },
            { category: "Hvilken film?", emojis: "ü¶ïü¶ñ", answer: "Jurassic Park", options: ["Godzilla", "Jurassic Park", "Toy Story", "Istid"] },
            { category: "Hvilken film?", emojis: "üëªüö´", answer: "Ghostbusters", options: ["Casper", "Ghostbusters", "Halloween", "Frustrerte Fruer"] },
            { category: "Hvilken film?", emojis: "üë∏‚ùÑÔ∏è‚òÉÔ∏è", answer: "Frost", options: ["Snehvit", "Askepott", "Frost", "Narnia"] },
            { category: "Hvilken film?", emojis: "üç´üè≠üé´", answer: "Charlie og Sjokoladefabrikken", options: ["Godteriland", "Charlie og Sjokoladefabrikken", "Hans og Grete", "Kakemonsteret"] },
            { category: "Hvilken film?", emojis: "üíçüåãü¶∂", answer: "Ringenes Herre", options: ["Hobbiten", "Game of Thrones", "Ringenes Herre", "Dungeons & Dragons"] },
            { category: "Hvilken film?", emojis: "ü§†üöÄüß∏", answer: "Toy Story", options: ["Small Soldiers", "Lego Filmen", "Toy Story", "Minions"] },
            { category: "Hvilken film?", emojis: "ü§°üéà", answer: "IT", options: ["Sirkus", "IT", "Joker", "Opp"] },
            { category: "Hvilken film?", emojis: "üêºü•ã", answer: "Kung Fu Panda", options: ["Karate Kid", "Mulan", "Kung Fu Panda", "Turning Red"] },
            { category: "Hvilken film?", emojis: "üîéüêü", answer: "Oppdrag Nemo", options: ["Den Lille Havfruen", "Oppdrag Nemo", "Haien", "Luca"] },
            { category: "Hvilken film?", emojis: "üëΩüö≤üåï", answer: "E.T.", options: ["Star Wars", "E.T.", "Alien", "Space Jam"] },
            { category: "Hvilken film?", emojis: "ü•äüêØ", answer: "Rocky", options: ["Karate Kid", "Raging Bull", "Rocky", "Creed"] },
            { category: "Hvilken film?", emojis: "üè¥‚Äç‚ò†Ô∏è‚öì", answer: "Pirates of the Caribbean", options: ["Peter Pan", "Pirates of the Caribbean", "Skatten p√• Sj√∏r√∏ver√∏ya", "Hook"] },
            { category: "Hvilken helt?", emojis: "ü¶áüë®", answer: "Batman", options: ["Superman", "Batman", "Joker", "Daredevil"] },
            { category: "Hvilken film?", emojis: "üöîüç©", answer: "Politiskolen", options: ["Brooklyn 99", "Politiskolen", "Die Hard", "The Wire"] },
            { category: "Hvilken film?", emojis: "üêÄüë®‚Äçüç≥", answer: "Ratatouille", options: ["Stuart Little", "Ratatouille", "Flukten fra H√∏nseg√•rden", "Musevisa"] },
            { category: "Hvilken film?", emojis: "üßü‚Äç‚ôÇÔ∏èüöÜ", answer: "Train to Busan", options: ["World War Z", "The Walking Dead", "Train to Busan", "Polarekspressen"] },
            { category: "Hvilken film?", emojis: "üë¥üè†üéà", answer: "Opp", options: ["Se opp", "Opp", "Hjemme Alene", "Luftslottet"] },
            { category: "Hvilken film-saga?", emojis: "üöÄüåå‚öîÔ∏è", answer: "Star Wars", options: ["Star Trek", "Guardians of the Galaxy", "Star Wars", "Dune"] },
            { category: "Hvilken film?", emojis: "ü§ñ‚ù§Ô∏èü§ñ", answer: "Wall-E", options: ["Big Hero 6", "Wall-E", "Robots", "Jernkjempen"] },
            { category: "Hvilken film?", emojis: "üëøüëóüë†", answer: "The Devil Wears Prada", options: ["Sex and the City", "Cruella", "The Devil Wears Prada", "Moteuka"] },
            { category: "Hvilken film?", emojis: "üêùüé¨", answer: "Bee Movie", options: ["Antz", "Sm√•kryp", "Bee Movie", "Honningbarna"] },
            { category: "Hvilket eventyr?", emojis: "üëßüå≤üê∫", answer: "R√∏dhette", options: ["Hans og Grete", "R√∏dhette", "Ulven kommer", "Skj√∏nnheten og Udyret"] },
            { category: "Hvilken serie?", emojis: "üßüüßüüßü", answer: "The Walking Dead", options: ["Zombieland", "The Last of Us", "The Walking Dead", "Thriller"] },
            { category: "Hvilken film?", emojis: "üßäüêøÔ∏èüå∞", answer: "Istid", options: ["Madagaskar", "Istid", "Over Hekken", "Bambi"] },
            
            // TING OG BEGREPER
            { category: "Hva er dette?", emojis: "üî•üöí", answer: "Brannbil", options: ["Politi", "Brannbil", "Ambulanse", "Racerbil"] },
            { category: "Hva er dette?", emojis: "üåßÔ∏èüåà", answer: "Regnbue", options: ["Uv√¶r", "Solskinn", "Regnbue", "Skyer"] },
            { category: "Hvor skal vi?", emojis: "üóΩüçé", answer: "New York", options: ["London", "Paris", "New York", "Oslo"] },
            { category: "Hvor skal vi?", emojis: "üóºü•ê", answer: "Paris", options: ["Roma", "Berlin", "Paris", "Madrid"] },
            { category: "Hvilket vesen?", emojis: "üßõ‚Äç‚ôÇÔ∏è‚ö∞Ô∏è", answer: "Vampyr", options: ["Zombie", "Varulv", "Vampyr", "Sp√∏kelse"] },
            { category: "Hvem er dette?", emojis: "üéÖüéÅü¶å", answer: "Julenissen", options: ["P√•skeharen", "Tannfeen", "Julenissen", "Sn√∏mannen"] },
            { category: "Hvilken feiring?", emojis: "üéÉüç¨", answer: "Halloween", options: ["Jul", "P√•ske", "Halloween", "Bursdag"] },
            { category: "Hva er dette?", emojis: "üëëüè∞", answer: "Slott", options: ["Hytte", "Hus", "Slott", "Telt"] },
            { category: "Hva gj√∏r vi?", emojis: "‚úàÔ∏èüå¥", answer: "Ferie", options: ["Jobb", "Skole", "Ferie", "Sykehus"] },
            { category: "Hva er dette?", emojis: "üéÆüïπÔ∏è", answer: "Videospill", options: ["Brettspill", "Videospill", "Fotball", "Lekser"] },
            { category: "Hvilken sport?", emojis: "‚öΩü•Ö", answer: "Fotball", options: ["H√•ndball", "Tennis", "Fotball", "Golf"] },
            { category: "Hvilken sjanger?", emojis: "üéªüéº", answer: "Klassisk Musikk", options: ["Rock", "Pop", "Jazz", "Klassisk Musikk"] },
            { category: "Hvilken mat?", emojis: "üçüüçîü•§", answer: "Fast Food", options: ["Gourmet", "Fast Food", "Frokost", "Salat"] },
            { category: "Hva kalles det?", emojis: "üìöüêõ", answer: "Bokorm", options: ["Slange", "Bokorm", "Larve", "Bibliotekar"] },
            { category: "Hva symboliseres?", emojis: "üß†üí°", answer: "Id√©", options: ["Hodepine", "Lysp√¶re", "Id√©", "Str√∏mbrudd"] },
            { category: "Hva gj√∏r personen?", emojis: "üò¥üí§", answer: "S√∏vn", options: ["L√∏ping", "Tenking", "S√∏vn", "Dagdr√∏m"] },
            { category: "Hva gj√∏r personen?", emojis: "üé§üéµ", answer: "Sang", options: ["Tale", "Sang", "Skrik", "Hvisking"] },
            { category: "Hvilket sted?", emojis: "üöëüè•", answer: "Sykehus", options: ["Brannstasjon", "Skole", "Sykehus", "Butikk"] },
            { category: "Hvem er dette?", emojis: "ü§†üê¥", answer: "Cowboy", options: ["Ridder", "Cowboy", "Bonde", "Pirat"] },

            // VIDEOSPILL
            { category: "Hvilket spill?", emojis: "‚õèÔ∏èüíéüßü", answer: "Minecraft", options: ["Roblox", "Minecraft", "Terraria", "Fortnite"] },
            { category: "Hvilket spill?", emojis: "üçÑüë®üèªüîß", answer: "Super Mario", options: ["Sonic", "Super Mario", "Luigi", "Pac-Man"] },
            { category: "Hvilket spill?", emojis: "‚ö°üêÅüü°", answer: "Pikachu", options: ["Sonic", "Pikachu", "Yoshi", "Kirby"] },
            { category: "Hvilket spill?", emojis: "üöó‚öΩüöÄ", answer: "Rocket League", options: ["FIFA", "Rocket League", "Mario Kart", "Gran Turismo"] },
            { category: "Hvilket spill?", emojis: "üõ°Ô∏èüó°Ô∏èüßù‚Äç‚ôÄÔ∏è", answer: "Zelda", options: ["Final Fantasy", "Zelda", "Witcher", "Skyrim"] },
            { category: "Hvilket spill?", emojis: "üçåü¶çüëî", answer: "Donkey Kong", options: ["King Kong", "Donkey Kong", "Curious George", "Tarzan"] },
            { category: "Hvilket spill?", emojis: "üî´üèóÔ∏èüéÆ", answer: "Fortnite", options: ["PUBG", "Fortnite", "Call of Duty", "Apex Legends"] },
            { category: "Hvilket spill?", emojis: "üëªüî¶üò±", answer: "Luigi's Mansion", options: ["Ghostbusters", "Luigi's Mansion", "Resident Evil", "Silent Hill"] },

            // MAT & DRIKKE
            { category: "Hvilken rett?", emojis: "üåÆü•ëüá≤üáΩ", answer: "Taco", options: ["Burrito", "Taco", "Nachos", "Kebab"] },
            { category: "Hvilken rett?", emojis: "üç£ü•¢üêü", answer: "Sushi", options: ["Fiskeboller", "Sushi", "Wok", "Reker"] },
            { category: "Hvilken rett?", emojis: "ü•ûüçÅüçØ", answer: "Pannekaker", options: ["Vaffel", "Pannekaker", "Br√∏dskive", "Kake"] },
            { category: "Hvilken rett?", emojis: "üå≠üçûüå≠", answer: "P√∏lse i br√∏d", options: ["Hamburger", "P√∏lse i br√∏d", "Kebab", "Pizza"] },
            { category: "Hvilken rett?", emojis: "üçùüáÆüáπ", answer: "Spaghetti", options: ["Lasagne", "Spaghetti", "Pizza", "Mac & Cheese"] },
            { category: "Hva er dette?", emojis: "üç©‚òïüëÆ", answer: "Donut", options: ["Kjeks", "Donut", "Bolle", "Croissant"] },
            { category: "Hvilken rett?", emojis: "ü•¶ü•ïü•í", answer: "Salat", options: ["Suppe", "Salat", "Gryterett", "Smoothie"] },
            { category: "Hva er dette?", emojis: "üç¶üçìüç´", answer: "Iskrem", options: ["Yoghurt", "Iskrem", "Pudding", "Milkshake"] },

            // DYRERIKET
            { category: "Hvilket dyr?", emojis: "ü¶íü¶íü¶í", answer: "Sjiraff", options: ["Zebra", "Sjiraff", "Elefant", "Kamel"] },
            { category: "Hvilket dyr?", emojis: "üêß‚ùÑÔ∏è‚õ∏Ô∏è", answer: "Pingvin", options: ["Isbj√∏rn", "Pingvin", "Sel", "M√•ke"] },
            { category: "Hvilket dyr?", emojis: "üêçüçéü§ê", answer: "Slange", options: ["Orm", "Slange", "√ògle", "Krokodille"] },
            { category: "Hvilket vesen?", emojis: "ü¶Ñüåà‚ú®", answer: "Enhj√∏rning", options: ["Hest", "Enhj√∏rning", "Pegasus", "Esel"] },
            { category: "Hvilket dyr?", emojis: "ü¶òü•äüá¶üá∫", answer: "Kenguru", options: ["Koala", "Kenguru", "Wombat", "Kanin"] },
            { category: "Hvilket dyr?", emojis: "üêôüåäü¶ë", answer: "Blekksprut", options: ["Manet", "Blekksprut", "Krabbe", "Hai"] },
            { category: "Hvilket dyr?", emojis: "ü¶áüåôü©∏", answer: "Flaggermus", options: ["Ugle", "Flaggermus", "M√•ke", "Ravn"] },
            { category: "Hvilket insekt?", emojis: "üêùüçØüåº", answer: "Bie", options: ["Veps", "Bie", "Humle", "Flue"] },

            // LAND & STEDER
            { category: "Hvilket land?", emojis: "üá≥üá¥‚õ∑Ô∏èüèîÔ∏è", answer: "Norge", options: ["Sverige", "Norge", "Danmark", "Finland"] },
            { category: "Hvilket land?", emojis: "üáØüáµüå∏üç£", answer: "Japan", options: ["Kina", "Japan", "Korea", "Thailand"] },
            { category: "Hvilket land?", emojis: "üáÆüáπüçïüèõÔ∏è", answer: "Italia", options: ["Frankrike", "Italia", "Hellas", "Spania"] },
            { category: "Hvilken by?", emojis: "üá¨üáß‚òïüíÇ", answer: "London", options: ["London", "Dublin", "New York", "Sydney"] },
            { category: "Hvilket land?", emojis: "üá™üá¨üê´üî∫", answer: "Egypt", options: ["Marokko", "Egypt", "Dubai", "India"] },
            { category: "Hvilket land?", emojis: "üá´üá∑ü•ñüóº", answer: "Frankrike", options: ["Italia", "Tyskland", "Frankrike", "Belgia"] },
            { category: "Hvilket land?", emojis: "üá∫üá∏üçîü¶Ö", answer: "USA", options: ["Canada", "USA", "Mexico", "Australia"] },
            { category: "Hvilket land?", emojis: "üáßüá∑‚öΩüíÉ", answer: "Brasil", options: ["Argentina", "Brasil", "Spania", "Portugal"] },
            
            // MUSIKK & ARTISTER
            { category: "Hvilken artist?", emojis: "üï∫üëëüé§", answer: "Michael Jackson", options: ["Elvis", "Michael Jackson", "Prince", "Bruno Mars"] },
            { category: "Hvilket band?", emojis: "üé∏‚ö°ü§ò", answer: "AC/DC", options: ["Metallica", "AC/DC", "KISS", "Nirvana"] },
            { category: "Hvilken artist?", emojis: "üéπüï∂Ô∏èüöÄ", answer: "Elton John", options: ["Billy Joel", "Elton John", "Freddie Mercury", "David Bowie"] },
            { category: "Hvilken artist?", emojis: "üë±‚Äç‚ôÄÔ∏èüíÑüé§", answer: "Taylor Swift", options: ["Katy Perry", "Taylor Swift", "Lady Gaga", "Beyonc√©"] }
        ];

        // --- STATE ---
        let currentLevelIndex = 0;
        let score = 0;
        let isAnswering = false;
        let gameLevels = []; 
        let timerInterval;
        let timeLeft;
        let selectedTimeLimit = 10; // Default

        // --- AUDIO ENGINE (Synth) ---
        const audioCtx = new (window.AudioContext || window.webkitAudioContext)();
        
        function playSound(type) {
            if (audioCtx.state === 'suspended') audioCtx.resume();
            
            const oscillator = audioCtx.createOscillator();
            const gainNode = audioCtx.createGain();
            
            oscillator.connect(gainNode);
            gainNode.connect(audioCtx.destination);
            
            if (type === 'correct') {
                oscillator.type = 'sine';
                oscillator.frequency.setValueAtTime(500, audioCtx.currentTime);
                oscillator.frequency.exponentialRampToValueAtTime(1000, audioCtx.currentTime + 0.1);
                gainNode.gain.setValueAtTime(0.3, audioCtx.currentTime);
                gainNode.gain.exponentialRampToValueAtTime(0.01, audioCtx.currentTime + 0.5);
                oscillator.start();
                oscillator.stop(audioCtx.currentTime + 0.5);
            } else if (type === 'wrong') {
                oscillator.type = 'sawtooth';
                oscillator.frequency.setValueAtTime(150, audioCtx.currentTime);
                oscillator.frequency.linearRampToValueAtTime(100, audioCtx.currentTime + 0.3);
                gainNode.gain.setValueAtTime(0.3, audioCtx.currentTime);
                gainNode.gain.exponentialRampToValueAtTime(0.01, audioCtx.currentTime + 0.3);
                oscillator.start();
                oscillator.stop(audioCtx.currentTime + 0.3);
            } else if (type === 'click') {
                oscillator.type = 'triangle';
                oscillator.frequency.setValueAtTime(800, audioCtx.currentTime);
                gainNode.gain.setValueAtTime(0.1, audioCtx.currentTime);
                gainNode.gain.exponentialRampToValueAtTime(0.01, audioCtx.currentTime + 0.05);
                oscillator.start();
                oscillator.stop(audioCtx.currentTime + 0.05);
            } else if (type === 'timeout') {
                oscillator.type = 'square';
                oscillator.frequency.setValueAtTime(100, audioCtx.currentTime);
                gainNode.gain.setValueAtTime(0.2, audioCtx.currentTime);
                gainNode.gain.exponentialRampToValueAtTime(0.01, audioCtx.currentTime + 0.5);
                oscillator.start();
                oscillator.stop(audioCtx.currentTime + 0.5);
            }
        }

        // --- UTILS ---
        function shuffleArray(array) {
            for (let i = array.length - 1; i > 0; i--) {
                const j = Math.floor(Math.random() * (i + 1));
                [array[i], array[j]] = [array[j], array[i]];
            }
            return array;
        }

        function createFloatingEmojis() {
            const container = document.getElementById('background-elements');
            const emojis = ['üçï', 'üöÄ', 'üéà', 'üéâ', 'ü¶Ñ', 'üåµ', 'üç©', 'üé®', 'üî•', 'üëª'];
            container.innerHTML = ''; // Clear existing
            
            for(let i = 0; i < 20; i++) {
                const el = document.createElement('div');
                el.innerText = emojis[Math.floor(Math.random() * emojis.length)];
                el.classList.add('floater');
                el.style.left = Math.random() * 100 + 'vw';
                el.style.animationDuration = (Math.random() * 15 + 10) + 's';
                el.style.animationDelay = (Math.random() * 10) + 's';
                el.style.fontSize = (Math.random() * 2 + 1) + 'rem';
                container.appendChild(el);
            }
        }

        function selectTime(val) {
            selectedTimeLimit = val;
            
            // UI Update
            document.querySelectorAll('.time-btn').forEach(btn => btn.classList.remove('selected'));
            if (val === 'inf') {
                document.getElementById('btn-inf').classList.add('selected');
            } else {
                document.getElementById('btn-' + val + 's').classList.add('selected');
            }
            playSound('click');
        }

        // --- CORE GAME LOGIC ---

        function startGame() {
            playSound('click');
            document.getElementById('start-screen').classList.add('hidden');
            document.getElementById('end-screen').classList.add('hidden');
            document.getElementById('game-screen').classList.remove('hidden');
            
            currentLevelIndex = 0;
            score = 0;
            
            // Randomize levels each game, take top 10
            gameLevels = shuffleArray([...levels]).slice(0, 10);
            
            updateScoreUI();
            loadLevel();
        }

        function loadLevel() {
            isAnswering = false;
            const levelData = gameLevels[currentLevelIndex];
            
            // UI Updates
            document.getElementById('level-display').innerText = `${currentLevelIndex + 1}/${gameLevels.length}`;
            document.getElementById('emoji-container').innerText = levelData.emojis;
            document.getElementById('category-text').innerText = levelData.category;
            document.getElementById('feedback-msg').style.opacity = '0';
            
            // Progress Bar
            const percent = (currentLevelIndex / gameLevels.length) * 100;
            document.getElementById('progress-bar').style.width = `${percent}%`;

            // Reset and Start Timer
            startTimer();

            // Setup Options
            const optionsContainer = document.getElementById('options-grid');
            optionsContainer.innerHTML = '';
            
            const shuffledOptions = shuffleArray([...levelData.options]);

            shuffledOptions.forEach((opt, index) => {
                const btn = document.createElement('button');
                btn.innerText = opt;
                btn.className = "option-btn bg-white/70 backdrop-blur text-gray-800 font-bold py-4 px-4 rounded-xl shadow-md border-b-4 border-gray-300 active:border-b-0 active:translate-y-1 text-lg hover:bg-white";
                // Stagger animation
                btn.style.animationDelay = (index * 0.1) + 's';
                
                btn.onclick = () => handleAnswer(btn, opt, levelData.answer);
                optionsContainer.appendChild(btn);
            });
        }

        function startTimer() {
            clearInterval(timerInterval);
            const timerBar = document.getElementById('timer-bar');
            const timerText = document.getElementById('timer-text');
            
            // Reset Styles
            timerBar.classList.remove('timer-active', 'timerShrink', 'timer-danger');
            timerBar.style.width = '100%';
            timerBar.style.backgroundColor = '#ef4444'; // Reset color

            if (selectedTimeLimit === 'inf') {
                timeLeft = Infinity;
                timerText.innerText = "‚àû";
                timerBar.style.width = '100%'; 
                timerBar.style.backgroundColor = '#4ade80'; // Green for infinite
                return;
            }

            timeLeft = selectedTimeLimit;
            updateTimerUI();
            
            void timerBar.offsetWidth; // Trigger reflow
            timerBar.style.animationDuration = `${selectedTimeLimit}s`;
            timerBar.classList.add('timer-active', 'timerShrink');
            
            timerInterval = setInterval(() => {
                timeLeft--;
                updateTimerUI();
                
                // Add Pulse warning at 3 seconds
                if (timeLeft <= 3 && timeLeft > 0) {
                     timerBar.classList.add('timer-danger');
                     playSound('click'); // Ticking sound
                }

                if (timeLeft <= 0) {
                    clearInterval(timerInterval);
                    handleTimeOut();
                }
            }, 1000);
        }

        function updateTimerUI() {
            if (timeLeft === Infinity) return;
            document.getElementById('timer-text').innerText = `${timeLeft}s`;
        }

        function handleTimeOut() {
            if (isAnswering) return;
            isAnswering = true;
            playSound('timeout');
            showFeedback("Tiden er ute! ‚è∞");
            
            const levelData = gameLevels[currentLevelIndex];
            const buttons = document.querySelectorAll('.option-btn');
            buttons.forEach(b => {
                b.disabled = true;
                if (b.innerText === levelData.answer) {
                    b.style.animationDelay = '0s'; // Clear delay
                    b.classList.add('pop-success');
                } else {
                     b.classList.add('opacity-50');
                }
            });

            setTimeout(() => {
                nextLevel();
            }, 2000);
        }

        function handleAnswer(btn, selected, correct) {
            if (isAnswering) return;
            isAnswering = true;
            clearInterval(timerInterval); 
            document.getElementById('timer-bar').classList.remove('timer-active', 'timer-danger'); 
            
            // IMPORTANT: Clear the animation delay on the clicked button 
            // so the color change happens instantly
            btn.style.animationDelay = '0s';

            if (selected === correct) {
                // CORRECT
                playSound('correct');
                
                // Bonus score for speed (0 if infinite)
                let bonus = 0;
                if (selectedTimeLimit !== 'inf') {
                    bonus = timeLeft * 10;
                    if(selectedTimeLimit === 5) bonus *= 2; // Double bonus for hard mode
                }
                
                score += (100 + bonus);
                
                btn.classList.remove('bg-white/70', 'text-gray-800', 'border-gray-300');
                btn.classList.add('pop-success');
                
                // Confetti
                const rect = btn.getBoundingClientRect();
                const x = (rect.left + rect.width / 2) / window.innerWidth;
                const y = (rect.top + rect.height / 2) / window.innerHeight;
                
                confetti({
                    particleCount: 60,
                    spread: 70,
                    origin: { x: x, y: y },
                    colors: ['#4ade80', '#ffffff', '#fbbf24']
                });

                if (bonus > 0) {
                    showFeedback(`Riktig! +${bonus} bonus! üåü`);
                } else {
                    showFeedback("Riktig! üåü");
                }

                setTimeout(() => {
                    nextLevel();
                }, 1200);

            } else {
                // WRONG
                playSound('wrong');
                btn.classList.remove('bg-white/70', 'text-gray-800', 'border-gray-300');
                btn.classList.add('pop-fail');
                
                const card = btn.parentElement.parentElement;
                card.classList.add('shake');
                setTimeout(() => card.classList.remove('shake'), 500);

                showFeedback("Feil svar üò¢");

                const buttons = document.querySelectorAll('.option-btn');
                buttons.forEach(b => {
                    if (b.innerText === correct) {
                        // Clear delay here too
                        b.style.animationDelay = '0s';
                        setTimeout(() => {
                            b.classList.add('pop-success');
                        }, 200);
                    }
                });

                setTimeout(() => {
                    nextLevel();
                }, 1500);
            }
            updateScoreUI();
        }

        function showFeedback(msg) {
            const el = document.getElementById('feedback-msg');
            el.innerText = msg;
            el.style.opacity = '1';
        }

        function nextLevel() {
            currentLevelIndex++;
            if (currentLevelIndex < gameLevels.length) {
                loadLevel();
            } else {
                gameOver();
            }
        }

        function updateScoreUI() {
            const scoreEl = document.getElementById('score-display');
            scoreEl.innerText = score;
            scoreEl.classList.add('scale-125');
            setTimeout(() => scoreEl.classList.remove('scale-125'), 100);
        }

        function gameOver() {
            playSound('correct');
            document.getElementById('game-screen').classList.add('hidden');
            document.getElementById('end-screen').classList.remove('hidden');
            
            document.getElementById('final-score').innerText = score;

            const title = document.getElementById('end-title');
            const feedback = document.getElementById('feedback-text');
            
            // Adjusted thresholds
            if (score > 1200) {
                title.innerText = "LEGENDARISK! üèÜ";
                feedback.innerText = "Lynrask og smart! Wow!";
                confetti({ particleCount: 200, spread: 100, origin: { y: 0.6 } });
            } else if (score > 800) {
                title.innerText = "Fantastisk! üéâ";
                feedback.innerText = "Du er en ekte ekspert.";
                confetti({ particleCount: 100, spread: 70, origin: { y: 0.6 } });
            } else {
                title.innerText = "Bra jobba! üëç";
                feedback.innerText = "Pr√∏v igjen for √• sl√• rekorden!";
            }
        }

        createFloatingEmojis();

    </script>
</body>
</html>
